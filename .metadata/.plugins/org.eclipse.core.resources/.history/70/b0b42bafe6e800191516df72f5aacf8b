package com.spoors.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;

import com.spoors.service.PersonService;

@Controller
public class PersonUpdateController {
	@Autowired
	PersonService service;
	 @RequestMapping(value = "/updatePerson/{id}", method = RequestMethod.GET)
	    public String selectForUpdate(@PathVariable Long id, Model model) {
	        model.addAttribute("person", personService.findById(id));
	        return "personUpdate";
	    }
	     
	    @RequestMapping(value="/updatePersonFailed", method=RequestMethod.GET)
	    public String updatePersonFailed() {
	        return "personUpdate";
	    }
	 
	    @RequestMapping(value = "/updatePerson", method = RequestMethod.POST)
	    public String performUpdate(@ModelAttribute Person person, RedirectAttributes redirectAttributes,
	            SessionStatus sessionStatus) {
	        String message = null;
	        String viewName = null;
	        try {
	            personService.update(person);
	            message = "Person updated. Person id :" + person.getId();
	            viewName = "redirect:/mvc/listPersons";
	            sessionStatus.setComplete();
	        } catch (Exception ex) {
	            message = "Person update failed. ";
	            viewName = "redirect:/mvc/updatePersonFailed";
	        }
	        redirectAttributes.addFlashAttribute("message", message);
	        return viewName;
	    }

}
